<!DOCTYPE html>

<!--
  Copyright (c) 2008-2012  Esko Luontola <www.orfjackal.net> and Lars Bergström <harhund.com>
  You may use and modify this source code freely for personal non-commercial use.
  This source code may NOT be used as course material without prior written agreement.

  @author Esko Luontola <www.orfjackal.net> (original Java/junit examples)
  @author Lars Bergström <harhund.com> (adaptation to Javascript/qunit)
-->
 
<html>
<head>
  <meta charset="utf-8">
  <title>Rotating a falling piece test</title>
  <link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-1.11.0.css">
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture"></div>
</body>

<script src="../src/board.js"></script>
<script src="../src/tetromino.js"></script>
<script src="../src/piece.js"></script>
<script src="../src/block.js"></script>
<script src="http://code.jquery.com/qunit/qunit-1.11.0.js"></script>
<script>
var board;

module("A falling piece", {
  setup: function() {
    board = new Board(6,8);
    board.drop(new Tetromino("T"));
  }
});

test("can be rotated clockwise", function() {
  board.rotateRight();
  equal(board.toString(), "" +
    "....T...\n" +
    "....TT..\n" +
    "....T...\n" +
    "........\n" +
    "........\n" +
    "........\n");
});

test("can be rotated counter-clockwise", function() {
  board.rotateLeft();
  equal(board.toString(), "" +
    "....T...\n" +
    "...TT...\n" +
    "....T...\n" +
    "........\n" +
    "........\n" +
    "........\n");
});

test("can be rotated next to wall", function() {
  board.moveLeft();
  board.moveLeft();
  board.moveLeft();
  board.rotateLeft();
  equal(board.toString(), "" +
    ".T......\n" +
    "TT......\n" +
    ".T......\n" +
    "........\n" +
    "........\n" +
    "........\n");
});

test("can not be rotated when there is no room to rotate off other piece", function() {
  board.tick();
  board.tick();
  board.tick();
  board.tick();
  board.tick(); //lock
  equal(board.toString(), "" +
    "........\n" +
    "........\n" +
    "........\n" +
    "........\n" +
    "....T...\n" +
    "...TTT..\n");
  board.drop(new Tetromino("S"));
  board.moveLeft();
  board.moveLeft();
  board.tick();
  board.tick();
  board.tick();
  board.tick();
  equal(board.toString(), "" +
    "........\n" +
    "........\n" +
    "........\n" +
    "........\n" +
    "..SST...\n" +
    ".SSTTT..\n");
  board.rotateRight();
  equal(board.toString(), "" +
    "........\n" +
    "........\n" +
    "........\n" +
    "........\n" +
    "..SST...\n" +
    ".SSTTT..\n");
  //other direction
  board.rotateLeft();
  equal(board.toString(), "" +
    "........\n" +
    "........\n" +
    "........\n" +
    "........\n" +
    "..SST...\n" +
    ".SSTTT..\n");
});

test("rotated off the left wall is moved away from the wall ('wallkicked')", function() {
  board.rotateRight();
  board.moveLeft();
  board.moveLeft();
  board.moveLeft();
  board.moveLeft();
  equal(board.toString(), "" +
    "T.......\n" +
    "TT......\n" +
    "T.......\n" +
    "........\n" +
    "........\n" +
    "........\n");
  board.rotateLeft();
  equal(board.toString(), "" +
    ".T......\n" +
    "TTT.....\n" +
    "........\n" +
    "........\n" +
    "........\n" +
    "........\n");
});

test("rotated off the right wall is moved away from the wall ('wallkicked')", function() {
  board.rotateLeft();
  board.moveRight();
  board.moveRight();
  board.moveRight();
  equal(board.toString(), "" +
    ".......T\n" +
    "......TT\n" +
    ".......T\n" +
    "........\n" +
    "........\n" +
    "........\n");
  board.rotateRight();
  equal(board.toString(), "" +
    "......T.\n" +
    ".....TTT\n" +
    "........\n" +
    "........\n" +
    "........\n" +
    "........\n");
});
    // See: http://bsixcentdouze.free.fr/tc/tgm-en/tgm.html
    // http://bsixcentdouze.free.fr/tc/tgm-en/img/wallkick1.png
    // http://bsixcentdouze.free.fr/tc/tgm-en/img/wallkick2.png
    // http://bsixcentdouze.free.fr/tc/tgm-en/img/wallkick3.png

</script>
</html> 
