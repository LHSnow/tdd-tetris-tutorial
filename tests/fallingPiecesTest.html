<!DOCTYPE html>

<!--
  Copyright (c) 2008-2012  Esko Luontola <www.orfjackal.net> and Lars Bergström <harhund.com>
  You may use and modify this source code freely for personal non-commercial use.
  This source code may NOT be used as course material without prior written agreement.

  @author Esko Luontola <www.orfjackal.net> (original Java/junit examples)
  @author Lars Bergström <harhund.com> (adaptation to Javascript/qunit)
-->
 
<html>
<head>
  <meta charset="utf-8">
  <title>Falling Pieces test</title>
  <link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-1.11.0.css">
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture"></div>
</body>

<script src="../src/board.js"></script>
<script src="../src/block.js"></script>
<script src="../src/piece.js"></script>
<script src="../src/tetromino.js"></script>
<script src="http://code.jquery.com/qunit/qunit-1.11.0.js"></script>
<script>

var board = null;


module("When a piece is dropped", {
  setup: function() {
      board = new Board(6, 8);
      board.drop(new Tetromino("T"));
  }
});

test("it starts from top middle", function() {
  equal(board.toString(), "" +
    "....T...\n" +
    "...TTT..\n" +
    "........\n" +
    "........\n" +
    "........\n" +
    "........\n");
});


module("When a piece reaches the bottom", {
  setup: function() {
      board = new Board(6, 8);
      board.drop(new Tetromino("T"));
      board.tick();
      board.tick();
      board.tick();
      board.tick();
  }
});

test("it is still falling on the last row", function() {
  equal(board.toString(), "" +
          "........\n" +
          "........\n" +
          "........\n" +
          "........\n" +
          "....T...\n" +
          "...TTT..\n");
  ok(board.hasFalling());
});

test("it stops when it hits the bottom", function() {
    board.tick();
    equal(board.toString(), "" +
            "........\n" +
            "........\n" +
            "........\n" +
            "........\n" +
            "....T...\n" +
            "...TTT..\n");
    ok(!board.hasFalling());
});


/*
    public class When_a_piece_lands_on_another_piece {

        @Before
        public void landOnAnother() {
            board.drop(Tetromino.T_SHAPE);
            board.tick();
            board.tick();
            board.tick();
            board.tick();
            board.tick();
            assertEquals("" +
                    "........\n" +
                    "........\n" +
                    "........\n" +
                    "........\n" +
                    "....T...\n" +
                    "...TTT..\n", board.toString());
            assertFalse(board.hasFalling());

            board.drop(Tetromino.T_SHAPE);
            board.tick();
            board.tick();
        }

        @Test
        public void it_is_still_falling_right_above_the_other_piece() {
            assertEquals("" +
                    "........\n" +
                    "........\n" +
                    "....T...\n" +
                    "...TTT..\n" +
                    "....T...\n" +
                    "...TTT..\n", board.toString());
            assertTrue(board.hasFalling());
        }

//        @Test
//        public void it_stops_when_it_hits_the_other_piece() {
//            board.tick();
//            assertEquals("" +
//                    "........\n" +
//                    "........\n" +
//                    "....T...\n" +
//                    "...TTT..\n" +
//                    "....T...\n" +
//                    "...TTT..\n", board.toString());
//            assertFalse(board.hasFalling());
//        }
    }
*/

</script>
</html> 
