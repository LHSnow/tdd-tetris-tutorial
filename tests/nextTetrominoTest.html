module("A new tetromino bag", {
  var bag;
  var tetromino;

  setup: function() {
    bag = new TetrominoBag();
  }

  test("does not have a record of previous pieces", function() {
    equal(bag.history.length, 0);
  });
});

module("Picking a tetromino from the bag", {
  setup: function() {
    bag = new TetrominoBag();
    tetromino = bag.pick();
  }
  test("returns a random tetromino", function() {
    var shapes = ["T", "O", "I", "S", "Z", "L", "J"];
    ok(shapes.indexOf(tetromino.shape) > -1);
  });

  test("adds it to bag history", function() {
    equal(bag.history.length, 1);
    equal(bag.history[0], tetromino.shape);
  });

  test("removes oldest history item if history exceeds 4 shapes", function() {
    var picked = new Array();
    picked.push(tetromino);
    for(var t = 0; t < 4; t++) {
      picked.push(bag.pick());
    }
    equal(bag.history.length, 4);
    for(var t = 0; t < 4; t++) {
      equal(bag.history[t], picked[t + 1].shape);
    }
  });
});



module("Peeking into the bag", {
  setup: function() {
    bag = new TetrominoBag();
    tetromino = bag.peek();
  }

  test("reveals next item to be picked", function() {
    equal(bag.pick().shape, tetromino.shape);
  });

  test("does not change the outcome of the next peek", function() {
    for(var i = 0; i < 10; i++) {
      equal(bag.peek().shape, tetromino.shape);
    }
  });
});
